# Kafka 4.0 & KRaft 관련 질문
## ✅ Q1. **Raft Quorum이란 무엇인가?**

**Raft**는 분산 시스템에서 **합의를 이루기 위한 알고리즘**이고, Kafka의 **KRaft 모드**는 이를 채택한 구조이다.


### "Quorum"의 정의:

> **Quorum**은 분산 시스템에서 **의사결정(쓰기/리더 선출 등)에 참여할 수 있는 최소한의 서버 수**를 의미한다.


### 💡 예시:

* KRaft 클러스터에 3개의 Controller 노드가 있다고 가정하자.

  ```
  node.id=1, 2, 3
  controller.quorum.voters=1@host1:9093,2@host2:9093,3@host3:9093
  ```
* 여기서 **Quorum = 과반수 (⌈N/2⌉ + 1)** = 2
* 따라서:

  * 2개 이상의 노드가 합의하면 → **commit 발생 가능**
  * 2개 이하로 떨어지면 → **쓰기 중단 (읽기는 일부 가능)**

### 안정성과 연결:

* Quorum은 \*\*장애 허용(Fault Tolerance)\*\*과 직결됩니다.
* 3대 구성 시 → 1대 장애 허용
* 5대 구성 시 → 2대까지 허용

> Kafka의 KRaft는 이 Quorum을 통해 controller 선출, 메타데이터 기록을 안전하게 처리할 수 있다.


---

## ✅ Q2. **KRaft는 Kafka 4.0부터 정식인가? 이전 버전은 여전히 ZooKeeper를 사용하는가?**

정확하게 정리하면:

| Kafka 버전     | KRaft 상태        | ZooKeeper 필요 여부         |
| ------------ | --------------- | ----------------------- |
| **2.8.x**    | 실험적 (Preview)   | 기본: ZooKeeper           |
| **3.0\~3.3** | 점진적 확장 중        | ZooKeeper + KRaft 혼용 가능 |
| **3.4\~3.6** | KRaft 기능 대부분 구현 | 일부 기능만 ZooKeeper        |
| **4.0**      | **정식(default)** | **ZooKeeper 완전 제거** ✔   |

> Kafka 4.0부터는 **KRaft 모드가 기본이며, ZooKeeper 관련 코드 자체가 제거됨**
> 즉, 4.0에서는 **무조건 KRaft**를 써야 한다.


### 📌 정리

* Kafka 3.x 이하 → 대부분 **ZooKeeper 기반**
* Kafka 4.0 이상 → **KRaft 전용** 구조 (이전 방식 불가)

---

## ✅ Q3. **요즘 실제 기업들은 KRaft로 많이 전환했는가?**

현업에서는 혼재되어 있다. 주요 추세는 아래와 같습니다:

| 유형                             | 설명                                                  |
| ------------------------------ | --------------------------------------------------- |
| **기존 Kafka 운영 중인 회사 (3.x 이하)** | 대부분 **아직 ZooKeeper 기반 유지** 중<br>마이그레이션에는 리스크/리소스 필요 |
| **새롭게 Kafka 도입 중인 회사**         | **Kafka 4.0 + KRaft로 바로 시작**하는 경우 많음                |
| **클라우드 기반 Kafka 사용 기업**        | Confluent Cloud 등은 내부적으로 이미 KRaft 전환 중              |
| **대규모 Kafka 운영 기업**            | 점진적으로 **테스트 클러스터 → 내부 툴 → 프로덕션 마이그레이션** 순으로 진행      |

### 현실적 고려사항

* 마이그레이션에는 **Downtime, 메타데이터 마이그레이션, 클러스터 재구성** 등이 필요하다. (비용 소모)
* 따라서 운영 중인 Kafka를 바로 바꾸기는 쉽지 않음 → **전환 추세는 있지만 점진적**


---
## ✅ Q4. **KRaft가 ZooKeeper 기반에 비해 갖는 주요 이점은?**

아래 표로 요약할 수 있다.

| 항목                 | ZooKeeper 기반 Kafka (3.x 이하) | KRaft 기반 Kafka (4.0 이상) |
| ------------------ | --------------------------- | ----------------------- |
| **구성 복잡도**         | Kafka + ZooKeeper 모두 필요     | Kafka 단독 구성 가능          |
| **운영 비용**          | ZooKeeper 운영/튜닝 필요          | Kafka 클러스터만 운영          |
| **Controller 선출**  | ZooKeeper에서 수행              | Kafka 내부에서 수행 (Raft)    |
| **메타데이터 저장소**      | ZooKeeper 외부 저장             | Kafka 내부 Raft log로 통합   |
| **속도**             | ZooKeeper와의 round-trip 발생   | Kafka 내부 처리로 빠름         |
| **디버깅/관찰성**        | Kafka와 ZooKeeper를 동시에 봐야 함  | Kafka만 추적하면 됨           |
| **설정 변경 등 실시간 반영** | ZooKeeper 반영 지연 가능성         | KRaft는 강력한 commit 보장    |

> → **시스템 단순화**, **운영비 절감**, **디버깅 용이**, **보안 통제 간편화**가 핵심 이점이다.


---
## ✅ 결론 요약

> Kafka 4.0의 **KRaft 모드**는 Kafka가 **완전한 분산 시스템으로 독립**하게 만든 핵심 구조이고, 그 기반이 되는 **Raft Quorum**은 **신뢰 가능한 메타데이터 복제와 리더 선출**을 위한 중심 개념이다.
> 현재 현업에서는 버전을 점진적으로 전환 중이며, 새로운 프로젝트에서는 **KRaft 채택이 사실상 표준**이 되어가고 있다.

